---
- name: Provisioning Web AMI
  hosts: dashboard-web
  serial: 1
  roles:
  - {role: software/common/tls, tags: [tls]}
  - {role: software/common/php-common, tags: [php]}
  - {role: geerlingguy.git}
  - {role: geerlingguy.nginx, tags: [nginx]}
  - {role: geerlingguy.php, tags: [php]}
  - {role: geerlingguy.php-mysql, tags: [php, php-mysql]}
  - {role: geerlingguy.php-memcached, tags: [php, php-memcached]}
  - {role: geerlingguy.composer, tags: [php]}
  - {role: software/dashboard/dashboard-sudo-2-init, tags: [deploy]}


- name: Deploying Dashboard
  hosts: dashboard-web
  serial: 1
  become: no
  roles:
  - {role: software/dashboard/dashboard-deploy, tags: [deploy]}


- name: Cleanup
  hosts: dashboard-web
  serial: 1
  roles:
  - {role: software/common/php-fixes, tags: [php, deploy]}
  - {role: software/dashboard/dashboard-sudo-3-cleanup, tags: [deploy]}



- name: Dashboard DB Migration
  hosts: dashboard-web
  serial: 1
  become: no
  roles:
  - {role: software/dashboard/dashboard-db-migrations, tags: [deploy, migrate]}
